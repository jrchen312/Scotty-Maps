{% extends "maps/base.html" %}

{% block title %}Floor{% endblock %}

{% block scripts %}
<script src="../../static/maps/floor.js"></script>
<link rel="stylesheet" href="../../static/maps/floor.css">
{% endblock %}

{% block header %}
{% include "maps/subtemplates/header.html" %}
{% endblock %}


{% block body %}

{{ floorId|json_script:"floor-id" }}
{{ tagId|json_script:"tag-id"}}

{{ floorScaling|json_script:"floor-scaling" }}

<div id="mapContainer">

    <!-- hover bubble for navigation directions -->
    <div class="card floorHeader" id="navigation-view" style="display:none">
        <div class="card-body">
            
            <div class="row">
                <div class="col-2 turn-indicator">
                    <span id="turn-direction-icon">
                        <i class="bi bi-sign-turn-left"></i>
                    </span>
                </div>
                <div class="col-10">
                    <div class="row">
                        <span id="turn-direction-text" class="navigation-font">Turn Left</span>
                    </div>
                    <div class="row">
                        <div>
                            <span id="turn-direction-distance">100</span>
                            <span id="turn-direction-distance-units">meters</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- hover bubble for navigation information -->
    <div class="card floorFooter" id="navigation-info" style="display:none">
        <div class="card-body">
            <div class="row">
                <!-- ETA in minutes + Distance in meters -->
                <div class="col">
                    <div class="row">
                        <div class="navigation-font">
                            <span id="navigation-time-remaining"></span>
                            <span id="navigation-time-remaining-units">min</span>
                        </div>
                    </div>
                    <div class="row">
                        <div>
                            <span id="navigation-distance-remaining">2000</span>
                            <span id="navigation-distance-remaining-units">meters</span>
                        </div>
                    </div>
                </div>
                <!-- Buttons for Leaving the view -->
                <div class="col exit-navigation">
                    <button type="button" class="btn btn-danger" id="exit-navigation-button">Exit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- header for inputting location  -->
    <div class="card floorHeader" id="location-select">
        <div id="error"></div>

        <div class="card-body">

            <form method="POST" action="{% url 'update-navigation' %}" id="form">
                {% csrf_token %}

                <label for="roomInput" class="form-label">Enter Location</label>
                
                <div class="input-group">
                    <input class="form-control" list="datalistOptions" id="roomInput" placeholder="Type to search...">
                    <datalist id="datalistOptions">
                        {% for room in rooms %}
                            <option value="{{ room.name }}">
                        {% endfor %}
                    </datalist>
                    <button class="btn btn-outline-secondary" type="submit" id="formSubmit">Go</button>
                </div>
            </form>
        </div>
    </div>

    

    <div id="loadingScreen">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
            <span style="color: white">Trying to connect</span>
        </div>
    </div>

    <!-- floor image background -->
    <img src="../../static/maps/{{ img_file }}" id="floorImg">
    
    <!-- hold the triangle for user position -->
    <div id="userPos"></div>

    <!-- hold the paths the user needs to travel -->
    <canvas id="userPaths"width="100" height="100"></canvas>
        
    </div>
</div>


{% endblock %}